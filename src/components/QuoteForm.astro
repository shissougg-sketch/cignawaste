---
interface Props {
  variant?: 'light' | 'dark';
  compact?: boolean;
}

const { variant = 'light', compact = false } = Astro.props;

const nassauTowns = [
  "Bethpage",
  "East Meadow",
  "Elmont",
  "Farmingdale",
  "Franklin Square",
  "Freeport",
  "Garden City",
  "Glen Cove",
  "Great Neck",
  "Hempstead",
  "Hicksville",
  "Levittown",
  "Long Beach",
  "Lynbrook",
  "Massapequa",
  "Merrick",
  "Mineola",
  "New Hyde Park",
  "Oceanside",
  "Oyster Bay",
  "Plainview",
  "Port Washington",
  "Rockville Centre",
  "Roosevelt",
  "Seaford",
  "Valley Stream",
  "Wantagh",
  "Westbury",
];

const suffolkTowns = [
  "Amityville",
  "Babylon",
  "Bay Shore",
  "Brentwood",
  "Brookhaven",
  "Commack",
  "Copiague",
  "Deer Park",
  "East Islip",
  "Huntington",
  "Islip",
  "Lake Ronkonkoma",
  "Lindenhurst",
  "Northport",
  "Patchogue",
  "Port Jefferson",
  "Riverhead",
  "Sayville",
  "Smithtown",
  "West Babylon",
  "West Islip",
];

const services = [
  "-- Select Service --",
  "Dumpster Rental",
  "Demolition",
  "Loading Service",
  "Dumpster + Loading Service",
  "Multiple Services",
];

const dumpsterSizes = [
  "-- Select Size (Optional) --",
  "10 Yard",
  "15 Yard",
  "20 Yard",
  "30 Yard",
  "Not Sure",
];

const inputClass = variant === 'dark'
  ? "w-full px-4 py-3.5 rounded-lg bg-gray-800 border border-gray-600 text-white placeholder-gray-400 focus:ring-2 focus:ring-cigna-yellow focus:border-transparent min-h-[44px]"
  : "w-full px-4 py-3.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-cigna-red focus:border-transparent min-h-[44px]";

const labelClass = variant === 'dark'
  ? "block text-sm sm:text-base font-medium text-gray-300 mb-1"
  : "block text-sm sm:text-base font-medium text-gray-700 mb-1";

// FormSubmit email - after first form submission, FormSubmit will send a confirmation email
// Once confirmed, the form will work automatically
const FORMSUBMIT_EMAIL = "Mike.Ciigna24@gmail.com";
---

<form
  id="quote-form"
  action={`https://formsubmit.co/ajax/${FORMSUBMIT_EMAIL}`}
  method="POST"
  class={compact ? "space-y-3" : "space-y-4"}
>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Name -->
    <div>
      <label for="name" class={labelClass}>Name *</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        maxlength="100"
        placeholder="Your name"
        class={inputClass}
        aria-required="true"
      />
    </div>

    <!-- Phone -->
    <div>
      <label for="phone" class={labelClass}>Phone *</label>
      <input
        type="tel"
        id="phone"
        name="phone"
        required
        maxlength="20"
        pattern="[\d\s\-\(\)\+]{10,20}"
        placeholder="(555) 555-5555"
        class={inputClass}
        aria-required="true"
      />
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Email -->
    <div>
      <label for="email" class={labelClass}>Email</label>
      <input
        type="email"
        id="email"
        name="email"
        maxlength="100"
        placeholder="your@email.com"
        class={inputClass}
      />
    </div>

    <!-- Town -->
    <div>
      <label for="town" class={labelClass}>Town *</label>
      <select
        id="town"
        name="town"
        required
        class={inputClass}
        aria-required="true"
      >
        <option value="">-- Select Town --</option>
        <optgroup label="Nassau County">
          {nassauTowns.map((town) => (
            <option value={town}>{town}</option>
          ))}
        </optgroup>
        <optgroup label="Suffolk County">
          {suffolkTowns.map((town) => (
            <option value={town}>{town}</option>
          ))}
        </optgroup>
        <option value="Other (specify in description)">Other (specify in description)</option>
      </select>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Service Type -->
    <div>
      <label for="service" class={labelClass}>Service Type *</label>
      <select
        id="service"
        name="service"
        required
        class={inputClass}
        aria-required="true"
      >
        {services.map((service) => (
          <option value={service === "-- Select Service --" ? "" : service}>{service}</option>
        ))}
      </select>
    </div>

    <!-- Dumpster Size -->
    <div>
      <label for="size" class={labelClass}>Dumpster Size</label>
      <select
        id="size"
        name="size"
        class={inputClass}
      >
        {dumpsterSizes.map((size) => (
          <option value={size.includes("--") ? "" : size}>{size}</option>
        ))}
      </select>
    </div>
  </div>

  <!-- Description -->
  <div>
    <label for="description" class={labelClass}>Tell us about your project</label>
    <textarea
      id="description"
      name="description"
      rows={compact ? 2 : 3}
      maxlength="1000"
      placeholder="Brief description of your project..."
      class={inputClass}
    ></textarea>
  </div>

  <!-- FormSubmit Configuration -->
  <input type="hidden" name="_subject" value="New Quote Request - Cigna Dumpsters">
  <input type="hidden" name="_template" value="table">
  <input type="text" name="_honey" class="hidden" tabindex="-1" autocomplete="off">

  <!-- Submit Button -->
  <button
    type="submit"
    id="submit-btn"
    class="w-full btn-primary text-xl py-4"
  >
    Get My Free Quote
  </button>

</form>

<!-- Success Message (shown after submission) -->
<div id="form-success" class="hidden">
  <div class={`p-6 sm:p-8 rounded-xl text-center ${variant === 'dark' ? 'bg-green-900/30' : 'bg-green-50'}`}>
    <div class={`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${variant === 'dark' ? 'bg-green-500/20' : 'bg-green-100'}`}>
      <svg class={`w-8 h-8 ${variant === 'dark' ? 'text-green-400' : 'text-green-600'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
    </div>
    <h3 class={`text-xl sm:text-2xl font-bold mb-2 ${variant === 'dark' ? 'text-white' : 'text-gray-900'}`}>Request Sent!</h3>
    <p class={`mb-4 ${variant === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>
      Thank you for reaching out. We'll get back to you shortly.
    </p>
    <p class={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>
      You can also call us at <a href="tel:+16318555502" class="text-cigna-yellow font-bold hover:underline">631-855-5502</a> for immediate assistance.
    </p>
  </div>
</div>

<!-- Error Message -->
<div id="form-error" class="hidden p-4 bg-red-100 text-red-800 rounded-lg text-center">
  Something went wrong. Please call us directly at <a href="tel:+16318555502" class="font-bold underline">631-855-5502</a>.
</div>

<script>
  const form = document.getElementById('quote-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const successMsg = document.getElementById('form-success');
  const errorMsg = document.getElementById('form-error');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Show loading state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    errorMsg?.classList.add('hidden');

    try {
      const formData = new FormData(form);

      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });

      if (response.ok) {
        // Success - hide form, show success message
        form.classList.add('hidden');
        successMsg?.classList.remove('hidden');
      } else {
        throw new Error('Form submission failed');
      }
    } catch (error) {
      // Error - show error message, reset button
      errorMsg?.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Get My Free Quote';
    }
  });
</script>
